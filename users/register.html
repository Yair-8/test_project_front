<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Користувачі</title>
    <!-- Підключення CSS для стилів -->
    <link rel="stylesheet" href="../style/main.css" />
    <!-- Підключення необхідних скриптів -->
    <script src="../scripts/RequestManager.js"></script>
    <script src="../scripts/FormManager.js"></script>
    <script src="../scripts/ListDataManager.js"></script>
    <script src="../scripts/settings.js"></script>
    <script src="../scripts/HeaderManager.js"></script>
    <script src="../scripts/UsersApiManager.js"></script>
  </head>
  <body>
    <script>
      // Використання класу HeaderManager для створення заголовка з меню
      document.addEventListener("DOMContentLoaded", async () => {
        //----- Вставка заголовку
        const headerManager = new HeaderManager(
          "products/form.html",
          menuItems
        );
      });
    </script>
    <!-- Контейнер -->
    <div id="container">
      <h1 class="title">Форма Користувача</h1>
    </div>
    <!-- Спіннер завантаження -->
    <div class="loading" id="loading-spinner" style="display: none;">
      <div class="spinner"></div>
      Завантаження...
    </div>
    <!-- Повідомлення про помилку -->
    <div class="error-message" id="error-message" style="display: none;">
      Виникла помилка при завантаженні даних.
    </div>
    <hr />

    <script>
      // Функція, що виконується при завантаженні сторінки
      document.addEventListener("DOMContentLoaded", async () => {
        // Function to fetch typesList
        //   async function fetchTypesList() {
        //     try {
        //       const response = await fetch("/api/user/types");
        //       const data = await response.json();
        //       return data.types || []; // Assuming the API returns { types: [...] }
        //     } catch (error) {
        //       console.error("Error fetching types list:", error);
        //       return [];
        //     }
        //   }
        // Функція для отримання даних та відображення форми
        async function fetchDataAndDisplay() {
          const loadingSpinner = document.getElementById("loading-spinner");
          const errorMessage = document.getElementById("error-message");
          const сontainer = document.getElementById("container");

          try {
            loadingSpinner.style.display = "block";
            сontainer.innerHTML = "";
            errorMessage.style.display = "none";

            // Fetch typesList dynamically
            // const typesList = await fetchTypesList();
            // console.log("typesList fetched:", typesList);

            //----- Вставка форми
            let userObj = {};
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get("id") || "";
            console.log("id============", id);
            if (id) {
              userObj = (await UsersApiManager.getUserById(id))?.data;
              console.log("User Data:==================", userObj);
              if (!userObj)
                throw new Error("Користувач відстуній або був видалений");
            }

            const submitCallback = async (data) => {
              console.log("Submitting data===========:", data);
              await UsersApiManager.addUser(data, id);
            };
            //---
            const fields = [
              { name: "username", type: "text", required: true, label: 'Ім"я' },
              { name: "email", type: "email", label: "Email" },
              { name: "password", type: "password", label: "Пароль" },
              {
                name: "type",
                type: "select",
                required: true,
                label: "Тип користувача",
                multiple: false,
                //  options: typesList,
                //Options will be dynamically populated
              },
            ];
            const form = new FormManager(fields, submitCallback, userObj || {});
            form.render("container");
          } catch (error) {
            console.error("Помилка при завантаженні даних:", error);
            errorMessage.style.display = "block";
          } finally {
            loadingSpinner.style.display = "none";
          }
        }

        // Виклик функції для отримання та відображення даних
        fetchDataAndDisplay();
      });
    </script>
  </body>
</html>
